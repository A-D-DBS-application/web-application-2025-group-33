{% extends "base.html" %}

{% block title %}Browse Papers{% endblock %}

{% block content %}
<!-- Research Interests Section -->
<div class="card" style="background-color: #f0f8ff; border-left: 4px solid #3498db; margin-bottom: 1.5rem;">
    <h2>Your Research Interests</h2>
    <p class="text-muted">Papers matching these interests will get higher relevance scores in recommendations.</p>
    
    {% if company_interests %}
        <div style="margin: 1rem 0;">
            <strong>Current interests:</strong>
            <div style="margin-top: 0.5rem;">
                {% for interest in company_interests.split(',') %}
                    <span style="display: inline-block; background-color: #3498db; color: white; padding: 4px 12px; border-radius: 15px; margin: 2px; font-size: 0.9rem;">
                        {{ interest.strip() }}
                    </span>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <p style="color: #e74c3c;"><strong>No research interests set.</strong> Add some to get better paper recommendations!</p>
    {% endif %}
    
    <form method="POST" action="{{ url_for('papers.update_research_interests') }}" style="margin-top: 1rem;">
        <div class="form-group">
            <label for="research_interests"><strong>Update Research Interests:</strong></label>
            <input type="text" id="research_interests" name="research_interests" 
                   value="{{ company_interests or '' }}"
                   placeholder="e.g., Machine Learning, AI, Data Science, Robotics"
                   style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
            <small class="text-muted">Separate multiple interests with commas</small>
        </div>
        <button type="submit" class="btn btn-success">Save Interests</button>
    </form>
</div>

<div class="card">
    <h1>Published Papers</h1>

    <div class="search-box mt-3">
        <form method="GET" action="{{ url_for('papers.company_dashboard') }}">
            <input type="text" name="search" placeholder="Search papers, authors, or research fields..." 
                   value="{{ search }}">
            <button type="submit" class="btn btn-small">Search</button>
            {% if search %}
                <a href="{{ url_for('papers.company_dashboard') }}" class="btn btn-small btn-secondary">Clear Search</a>
            {% endif %}
        </form>
    </div>
</div>

{% if papers %}
    <div class="paper-list">
        {% for paper in papers %}
            <div class="paper-item">
                <h3>
                    <a href="{{ url_for('papers.view_paper', paper_id=paper.id) }}" class="paper-link">
                        {{ paper.title }}
                    </a>
                    {% if paper.is_interested %}
                        <span class="star">â˜…</span>
                    {% endif %}
                </h3>

                <div class="paper-meta">
                    Published: {{ paper.created_at.strftime('%Y-%m-%d') }} | Updated: {{ paper.updated_at.strftime('%Y-%m-%d') }}
                </div>
                <div>
                    <strong>Authors:</strong>
                    {% for author in paper.authors %}
                        {{ author.first_name }} {{ author.last_name }} ({{ author.university }}){% if not loop.last %}, {% endif %}
                    {% endfor %}
                </div>

                <div class="mt-2">
                    <a href="{{ url_for('papers.view_paper', paper_id=paper.id) }}" class="btn btn-small">View Details</a>
                    <a href="{{ url_for('papers.download_paper', paper_id=paper.id) }}" class="btn btn-small btn-secondary ml-1">Download PDF</a>

                    <form method="POST" action="{{ url_for('interests.toggle_interest', paper_id=paper.id) }}" class="inline-form ml-1">
                        {% if paper.is_interested %}
                            <button type="submit" class="btn btn-small btn-danger">Remove Interest</button>
                        {% else %}
                            <button type="submit" class="btn btn-small btn-success">Mark as Interested</button>
                        {% endif %}
                    </form>
                </div>
            </div>
        {% endfor %}
    </div>
{% else %}
    <div class="card">
        <p>No published papers found{% if search %} matching "{{ search }}"{% endif %}.</p>
    </div>
{% endif %}
{% endblock %}

